<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <title>× ×™×”×•×œ ×§×‘×•×¦×•×ª</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            direction: rtl;
            text-align: right;
            padding: 20px;
        }
        label, input, button {
            display: block;
            margin-bottom: 10px;
            padding: 8px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: right;
        }
        th {
            background-color: lightgray;
        }
    </style>
</head>
<body>
    <h1>ğŸ“‹ × ×™×”×•×œ ×§×‘×•×¦×•×ª</h1>
    
    <button onclick="getGroups()">ğŸ“¥ ×˜×¢×Ÿ ×¨×©×™××ª ×§×‘×•×¦×•×ª</button>
    <h2>ğŸ” ×—×™×¤×•×© ×§×‘×•×¦×”</h2>
    <input type="text" id="searchQuery" placeholder="×©× ×§×‘×•×¦×”">
    <button onclick="searchGroups()">ğŸ” ×—×¤×©</button>
    <div id="searchResults"></div>
<!-- ×”×•×¡×¤×ª ×§×‘×•×¦×” ×—×“×©×”  -->
<h2>â• ×”×•×¡×¤×ª ×§×‘×•×¦×” ×—×“×©×”</h2>
<form id="addGroupForm">
    <label>××™××™×™×œ:</label> <input type="email" id="addEmail" required>
    <label>××›×™× ×”:</label> <input type="number" id="addIsPreparatorySchool" required>
    <label>×©× ×§×‘×•×¦×”:</label> <input type="text" id="addName" required>
    <label>××—×¨××™:</label> <input type="text" id="addNameOfResponsible" required>
    <label>×˜×œ×¤×•×Ÿ:</label> <input type="text" id="addPhone" required>
    <label>×›××•×ª ×—×‘×¨×™×:</label> <input type="number" id="addGroupQuantity" required>
    <label>×˜×•×•×— ×ª××¨×™×›×™×:</label> <input type="date" id="addDateRange" required>
    <label>×©×¢×ª ×”×ª×—×œ×”:</label> <input type="time" id="addRelevantStartTime" required>
    <label>×©×¢×ª ×¡×™×•×:</label> <input type="time" id="addRelevantEndTime" required>
    <label>××–×•×¨ ××•×¢×“×£:</label> <input type="text" id="addPreferredArea" required>
    <label>×˜×•×•×— ×’×™×œ××™×:</label> <input type="text" id="addAgeRange" required>
    <label>×”×ª×¢× ×™×™× ×•×ª ×‘×”×ª× ×“×‘×•×ª ×§×‘×•×¢×”:</label> <input type="number" id="addPermanentVolunteeringInterest" required>
    <label>×¡×˜×˜×•×¡ (×¤×¢×™×œ/×œ× ×¤×¢×™×œ):</label> <input type="number" id="addACTIV" required>
    <button type="submit">â• ×”×•×¡×£ ×§×‘×•×¦×”</button>
</form>

    <table id="groupsTable">
        <thead>
            <tr>
                <th>××™××™×™×œ</th>
                <th>××›×™× ×”</th>
                <th>×©× ×§×‘×•×¦×”</th>
                <th>××—×¨××™</th>
                <th>×˜×œ×¤×•×Ÿ</th>
                <th>×›××•×ª ×—×‘×¨×™×</th>
                <th>×˜×•×•×— ×ª××¨×™×›×™×</th>
                <th>×©×¢×ª ×”×ª×—×œ×”</th>
                <th>×©×¢×ª ×¡×™×•×</th>
                <th>××–×•×¨ ××•×¢×“×£</th>
                <th>×˜×•×•×— ×’×™×œ××™×</th>
                <th>××ª×¢× ×™×™× ×™× ×‘×”×ª× ×“×‘×•×ª ×§×‘×•×¢×”</th>
                <th>×¡×˜×˜×•×¡ (×¤×¢×™×œ/×œ× ×¤×¢×™×œ)</th>
                <th>ğŸ“ ×¢×¨×•×š</th>
                <th>ğŸ—‘ï¸ ××—×§</th>
            </tr>
        </thead>
        <tbody></tbody> <!-- ×›××Ÿ ×™×•×¦×’×• ×”× ×ª×•× ×™× -->
    </table>
    
</body>
<script>
    // ×”×¦×’×ª ×›×œ ×”×§×‘×•×¦×•×ª 
 async function getGroups() {
    try {
        console.log("ğŸ“¡ ×©×œ×™×—×ª ×‘×§×©×” ×œ×˜×¢×™× ×ª ×›×œ ×”×§×‘×•×¦×•×ª...");
        
        const response = await fetch("http://localhost:3333/groupD/all");

        if (!response.ok) {
            throw new Error(`âŒ ×©×’×™××” ×‘×©×¨×ª: ${response.status}`);
        }

        const data = await response.json();
        console.log("âœ… × ×ª×•× ×™× ×©×”×ª×§×‘×œ×•:", data);

        const tableBody = document.querySelector("#groupsTable tbody");
        tableBody.innerHTML = ""; // ×× ×§×” ××ª ×”×˜×‘×œ×”

        data.forEach(group => {
            const row = `<tr id="row-${group.ID}">
                <td><input type="email" value="${group.Email}" id="email-${group.ID}" disabled></td>
                <td><input type="number" value="${group.IsPreparatorySchool}" id="prep-${group.ID}" disabled></td>
                <td><input type="text" value="${group.Name}" id="name-${group.ID}" disabled></td>
                <td><input type="text" value="${group.NameOfResponsible}" id="responsible-${group.ID}" disabled></td>
                <td><input type="text" value="${group.Phone}" id="phone-${group.ID}" disabled></td>
                <td><input type="number" value="${group.GroupQuantity}" id="quantity-${group.ID}" disabled></td>
                <td><input type="date" value="${group.DateRange}" id="dateRange-${group.ID}" disabled></td>
                <td><input type="time" value="${group.RelevantStartTime}" id="startTime-${group.ID}" disabled></td>
                <td><input type="time" value="${group.RelevantEndTime}" id="endTime-${group.ID}" disabled></td>
                <td><input type="text" value="${group.PreferredArea}" id="area-${group.ID}" disabled></td>
                <td><input type="text" value="${group.AgeRange}" id="ageRange-${group.ID}" disabled></td>
                <td><input type="number" value="${group.PermanentVolunteeringInterest}" id="volunteerInterest-${group.ID}" disabled></td>
                <td><input type="number" value="${group.ACTIV}" id="activ-${group.ID}" disabled></td>
                <td>
                    <button onclick="enableEdit(${group.ID})">ğŸ“ ×¢×¨×•×š</button>
                    <button onclick="saveEdit(${group.ID})" id="save-btn-${group.ID}" style="display:none;">ğŸ’¾ ×©××•×¨</button>
                </td>
                <td><button onclick="deleteGroup(${group.ID})">ğŸ—‘ï¸ ××—×§</button></td>
            </tr>`;
            tableBody.innerHTML += row;
        });

    } catch (error) {
        console.error("âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×”×§×‘×•×¦×•×ª:", error);
        alert("âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×¨×©×™××ª ×”×§×‘×•×¦×•×ª");
    }
}
 //×—×™×¤×•×© 
 async function searchGroups() {
    try {
        const query = document.getElementById("searchQuery").value.trim();

        if (!query) {
            alert("âŒ × × ×œ×”×–×™×Ÿ ×©× ×§×‘×•×¦×” ××• ×©× ××—×¨××™ ×œ×—×™×¤×•×©!");
            return;
        }

        console.log(`ğŸ“¡ ×©×œ×™×—×ª ×‘×§×©×” ×œ×—×™×¤×•×© ×§×‘×•×¦×•×ª ×¢× ×”×©× ××• ×©× ×”××—×¨××™: "${query}"`);

        const response = await fetch(`http://localhost:3333/groupD/search?query=${query}`);

        if (!response.ok) {
            throw new Error(`âŒ ×©×’×™××” ×‘×©×¨×ª: ${response.status}`);
        }

        const data = await response.json();
        console.log("âœ… ×ª×•×¦××•×ª ×©×”×ª×§×‘×œ×•:", data);

        const resultsDiv = document.getElementById("searchResults");
        resultsDiv.innerHTML = ""; 

        if (data.length === 0) {
            resultsDiv.innerHTML = `<p>âŒ ×œ× × ××¦××• ×§×‘×•×¦×•×ª ×¢× ×”×©× "${query}"</p>`;
            return;
        }

        data.forEach(group => {
            resultsDiv.innerHTML += `<p>ğŸ‘¥ <strong>${group.Name}</strong> - ××—×¨××™: ${group.NameOfResponsible}, ×˜×œ×¤×•×Ÿ: ${group.Phone}</p>`;
        });

    } catch (error) {
        console.error("âŒ ×©×’×™××” ×‘×—×™×¤×•×© ×§×‘×•×¦×•×ª:", error);
        alert("âŒ ×©×’×™××” ×‘×—×™×¤×•×© ×§×‘×•×¦×•×ª: " + error.message);
    }
}

//×”×•×¡×¤×ª ×§×‘×•×¦×” 
document.getElementById("addGroupForm").addEventListener("submit", async function(event) {
    event.preventDefault();

    const newGroup = {
        Email: document.getElementById("addEmail").value || null,
        IsPreparatorySchool: document.getElementById("addIsPreparatorySchool").value || 0,
        Name: document.getElementById("addName").value,
        NameOfResponsible: document.getElementById("addNameOfResponsible").value,
        Phone: document.getElementById("addPhone").value,
        GroupQuantity: document.getElementById("addGroupQuantity").value || 0,
        DateRange: document.getElementById("addDateRange").value || null,
        RelevantStartTime: document.getElementById("addRelevantStartTime").value || "00:00",
        RelevantEndTime: document.getElementById("addRelevantEndTime").value || "00:00",
        PreferredArea: document.getElementById("addPreferredArea").value || null,
        AgeRange: document.getElementById("addAgeRange").value || null,
        PermanentVolunteeringInterest: document.getElementById("addPermanentVolunteeringInterest").value || 0,
        ACTIV: document.getElementById("addACTIV").value || 0
    };

    console.log("ğŸ“¡ ×©×œ×™×—×ª ×‘×§×©×” ×œ×”×•×¡×¤×ª ×§×‘×•×¦×” ×—×“×©×”:", newGroup);

    try {
        const response = await fetch("http://localhost:3333/groupD/add", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(newGroup)
        });

        if (!response.ok) {
            throw new Error(`âŒ ×©×’×™××” ×‘×”×•×¡×¤×ª ×§×‘×•×¦×”: ${response.status}`);
        }

        alert("âœ… ×§×‘×•×¦×” × ×•×¡×¤×” ×‘×”×¦×œ×—×”!");
        document.getElementById("addGroupForm").reset();
        getGroups(); // ×¨×¢× ×•×Ÿ ×”×¨×©×™××”

    } catch (error) {
        console.error("âŒ ×©×’×™××” ×‘×”×•×¡×¤×ª ×§×‘×•×¦×”:", error);
        alert("âŒ ×©×’×™××” ×‘×”×•×¡×¤×ª ×§×‘×•×¦×”: " + error.message);
    }
});
// ×¢×“×›×•×Ÿ
function enableEdit(id) {
    document.getElementById(`email-${id}`).disabled = false;
    document.getElementById(`prep-${id}`).disabled = false;
    document.getElementById(`name-${id}`).disabled = false;
    document.getElementById(`responsible-${id}`).disabled = false;
    document.getElementById(`phone-${id}`).disabled = false;
    document.getElementById(`quantity-${id}`).disabled = false;
    document.getElementById(`dateRange-${id}`).disabled = false;
    document.getElementById(`startTime-${id}`).disabled = false;
    document.getElementById(`endTime-${id}`).disabled = false;
    document.getElementById(`area-${id}`).disabled = false;
    document.getElementById(`ageRange-${id}`).disabled = false;
    document.getElementById(`volunteerInterest-${id}`).disabled = false;
    document.getElementById(`activ-${id}`).disabled = false;

    document.getElementById(`save-btn-${id}`).style.display = "inline-block";
}

//×©××™×¨×ª ×”×¢×“×›×•×Ÿ 
async function saveEdit(id) {
    const updatedData = {
        Email: document.getElementById(`email-${id}`).value,
        IsPreparatorySchool: document.getElementById(`prep-${id}`).value,
        Name: document.getElementById(`name-${id}`).value,
        NameOfResponsible: document.getElementById(`responsible-${id}`).value,
        Phone: document.getElementById(`phone-${id}`).value,
        GroupQuantity: document.getElementById(`quantity-${id}`).value,
        DateRange: document.getElementById(`dateRange-${id}`).value,
        RelevantStartTime: document.getElementById(`startTime-${id}`).value,
        RelevantEndTime: document.getElementById(`endTime-${id}`).value,
        PreferredArea: document.getElementById(`area-${id}`).value,
        AgeRange: document.getElementById(`ageRange-${id}`).value,
        PermanentVolunteeringInterest: document.getElementById(`volunteerInterest-${id}`).value,
        ACTIV: document.getElementById(`activ-${id}`).value
    };

    try {
        console.log(`ğŸ“¡ ×©×œ×™×—×ª ×¢×“×›×•×Ÿ ×œ-ID: ${id}`, updatedData);

        const response = await fetch(`http://localhost:3333/groupD/edit/${id}`, {
            method: "PATCH",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(updatedData)
        });

        if (!response.ok) {
            throw new Error(`âŒ ×©×’×™××” ×‘×¢×“×›×•×Ÿ: ${response.status}`);
        }

        alert("âœ… ×§×‘×•×¦×” ×¢×•×“×›× ×” ×‘×”×¦×œ×—×”!");
        getGroups();

    } catch (error) {
        console.error("âŒ ×©×’×™××” ×‘×¢×“×›×•×Ÿ ×§×‘×•×¦×”:", error);
        alert("âŒ ×©×’×™××” ×‘×¢×“×›×•×Ÿ ×§×‘×•×¦×”: " + error.message);
    }
}
//××—×™×§×” 
    async function deleteGroup(id) {
        if (!confirm("ğŸ—‘ï¸ ×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×”×§×‘×•×¦×”?")) return;

        await fetch(`http://localhost:3333/groupD/delete/${id}`, { method: "DELETE" });

        alert("âœ… ×§×‘×•×¦×” × ××—×§×” ×‘×”×¦×œ×—×”!");
        getGroups(); 
    }
</script>
</html>
