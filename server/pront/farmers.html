<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <title>× ×™×”×•×œ ×—×§×œ××™×</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            direction: rtl;
            text-align: right;
            padding: 20px;
        }
        label, input, button {
            display: block;
            margin-bottom: 10px;
            padding: 8px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: right;
        }
        th {
            background-color: lightgray;
        }
    </style>
</head>
<body>
    <h1>ğŸ“‹ × ×™×”×•×œ ×—×§×œ××™×</h1>
    
    <!-- ğŸ”¹ ×˜×‘×œ×ª ×›×œ ×”×—×§×œ××™× -->
    <h2>ğŸ“œ ×¨×©×™××ª ×—×§×œ××™×</h2>
    <button onclick="getFarmers()">ğŸ“¥ ×˜×¢×Ÿ ×¨×©×™××ª ×—×§×œ××™×</button>
    <table id="farmersTable">
        <thead>
            <tr>
                <th>×©×</th>
                <th>×©× ×—×•×•×”</th>
                <th>×˜×œ×¤×•×Ÿ</th>
                <th>××™××™×™×œ</th>
                <th>×›×ª×•×‘×ª</th>
                <th>×›××•×ª ×“×•× ××™×</th>
                <th>×™××™ ×¢×‘×•×“×”</th>
                <th>×ª×™××•×¨ ×¢×‘×•×“×”</th>
                <th>×ª×¢×•×“×ª ×–×”×•×ª</th>
                <th>×©×¢×ª ×”×ª×—×œ×”</th>
                <th>×©×¢×ª ×¡×™×•×</th>
                <th>××¡×¤×¨ ××ª× ×“×‘×™× ×¨×¦×•×™</th>
                <th>×¡×˜×˜×•×¡ (×¤×¢×™×œ/×œ× ×¤×¢×™×œ)</th>
                <th>ğŸ“ ×¢×¨×•×š</th>
                <th>ğŸ—‘ï¸ ××—×§</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <!-- ğŸ”¹ ×—×™×¤×•×© ×—×§×œ××™ ×œ×¤×™ ×©× -->
    <h2>ğŸ” ×—×™×¤×•×© ×—×§×œ××™ ×œ×¤×™ ×©× / ×—×•×•×”</h2>
    <input type="text" id="searchQuery" placeholder="×”×›× ×¡ ×©× ×—×§×œ××™ ××• ×©× ×—×•×•×”">
    <button onclick="searchFarmers()">ğŸ” ×—×¤×©</button>
    <div id="searchResults"></div>

    <!-- ğŸ”¹ ×”×•×¡×¤×ª ×—×§×œ××™ ×—×“×© -->
    <h2>â• ×”×•×¡×¤×ª ×—×§×œ××™ ×—×“×©</h2>
    <form id="addFarmerForm">
        <label>×©×:</label> <input type="text" id="Name" required>
        <label>×©× ×—×•×•×”:</label> <input type="text" id="FarmName" required>
        <label>×˜×œ×¤×•×Ÿ:</label> <input type="text" id="Telephone" required>
        <label>××™××™×™×œ:</label> <input type="email" id="Email" required>
        <label>×›×ª×•×‘×ª:</label> <input type="text" id="Address" required>
        <label>×›××•×ª ×“×•× ××™×:</label> <input type="number" id="QuantityOfDunams" required>
        <label>×™××™ ×¢×‘×•×“×”:</label> <input type="text" id="WorkingDays" required>
        <label>×ª×™××•×¨ ×”×¢×‘×•×“×”:</label> <input type="text" id="BriefExplanationOfWork" required>
        <label>×ª×¢×•×“×ª ×–×”×•×ª:</label> <input type="text" id="IDNumber" required>
        <label>×©×¢×ª ×”×ª×—×œ×”:</label> <input type="time" id="RelevantStartTime" required>
        <label>×©×¢×ª ×¡×™×•×:</label> <input type="time" id="RelevantEndTime" required>
        <label>××¡×¤×¨ ××ª× ×“×‘×™× ×¨×¦×•×™:</label> <input type="number" id="DesiredVolunteersCount" required>
        <label>×¡×˜×˜×•×¡ (×¤×¢×™×œ/×œ× ×¤×¢×™×œ):</label> <input type="number" id="ACTIV" placeholder="1 = ×¤×¢×™×œ, 0 = ×œ× ×¤×¢×™×œ" required>
        <button type="submit">â• ×”×•×¡×£ ×—×§×œ××™</button>
    </form>
    
    <script>
        // ğŸ”¹ **×©×œ×™×¤×ª ×›×œ ×”×—×§×œ××™×**
        async function getFarmers() {
    try {
        console.log("ğŸ“¡ ×©×œ×™×—×ª ×‘×§×©×” ×œ×˜×¢×™× ×ª ×›×œ ×”×—×§×œ××™×...");
        
        const response = await fetch("http://localhost:3333/farmerD/All");

        if (!response.ok) {
            throw new Error(`âŒ ×©×’×™××” ×‘×©×¨×ª: ${response.status}`);
        }

        const data = await response.json();
        console.log("âœ… × ×ª×•× ×™× ×©×”×ª×§×‘×œ×•:", data);

        const tableBody = document.querySelector("#farmersTable tbody");
        tableBody.innerHTML = ""; // ×× ×§×” ××ª ×”×˜×‘×œ×”

        data.forEach(farmer => {
            const row = `<tr id="row-${farmer.ID}">
                <td><input type="text" value="${farmer.Name}" id="name-${farmer.ID}" disabled></td>
                <td><input type="text" value="${farmer.FarmName}" id="farmName-${farmer.ID}" disabled></td>
                <td><input type="text" value="${farmer.Telephone}" id="telephone-${farmer.ID}" disabled></td>
                <td><input type="email" value="${farmer.Email}" id="email-${farmer.ID}" disabled></td>
                <td><input type="text" value="${farmer.Address}" id="address-${farmer.ID}" disabled></td>
                <td><input type="number" value="${farmer.QuantityOfDunams}" id="quantity-${farmer.ID}" disabled></td>
                <td><input type="text" value="${farmer.WorkingDays}" id="workingDays-${farmer.ID}" disabled></td>
                <td><input type="text" value="${farmer.BriefExplanationOfWork}" id="briefExplanation-${farmer.ID}" disabled></td>
                <td><input type="text" value="${farmer.IDNumber}" id="idNumber-${farmer.ID}" disabled></td>
                <td><input type="time" value="${farmer.RelevantStartTime}" id="startTime-${farmer.ID}" disabled></td>
                <td><input type="time" value="${farmer.RelevantEndTime}" id="endTime-${farmer.ID}" disabled></td>
                <td><input type="number" value="${farmer.DesiredVolunteersCount}" id="volunteers-${farmer.ID}" disabled></td>
                <td><input type="number" value="${farmer.ACTIV}" id="activ-${farmer.ID}" disabled></td>
                <td>
                    <button onclick="enableEdit(${farmer.ID})" id="edit-btn-${farmer.ID}">ğŸ“ ×¢×¨×•×š</button>
                    <button onclick="saveEdit(${farmer.ID})" id="save-btn-${farmer.ID}" style="display:none;">ğŸ’¾ ×©××•×¨</button>
                </td>
                <td><button onclick="deleteFarmer(${farmer.ID})">ğŸ—‘ï¸ ××—×§</button></td>
            </tr>`;
            tableBody.innerHTML += row;
        });

    } catch (error) {
        console.error("âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×”×—×§×œ××™×:", error);
        alert("âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×¨×©×™××ª ×”×—×§×œ××™×");
    }
}
        // ğŸ”¹ **×—×™×¤×•×© ×—×§×œ××™× ×œ×¤×™ ×©× ××• ×—×•×•×”**
        async function searchFarmers() {
    try {
        const queryInput = document.getElementById("searchQuery");
        if (!queryInput) {
            throw new Error("âŒ ××œ×× ×˜ ×”×—×™×¤×•×© ×œ× × ××¦× ×‘-HTML!");
        }

        const query = queryInput.value.trim(); // ×”×¡×¨×ª ×¨×•×•×—×™× ××™×•×ª×¨×™×

        if (!query) {
            alert("âŒ × × ×œ×”×–×™×Ÿ ×©× ×œ×—×™×¤×•×©!");
            return;
        }

        console.log(`ğŸ“¡ ×©×œ×™×—×ª ×‘×§×©×” ×œ×—×™×¤×•×© ×—×§×œ××™× ×¢× ×”×¢×¨×š: "${query}"`);

        const response = await fetch(`http://localhost:3333/farmerD/search?query=${query}`);

        if (!response.ok) {
            throw new Error(`âŒ ×©×’×™××” ×‘×©×¨×ª: ${response.status} - ${await response.text()}`);
        }

        const data = await response.json();
        console.log("âœ… ×ª×•×¦××•×ª ×©×”×ª×§×‘×œ×•:", data);

        const resultsDiv = document.getElementById("searchResults");
        if (!resultsDiv) {
            throw new Error("âŒ ××œ×× ×˜ searchResults ×œ× × ××¦× ×‘-HTML!");
        }

        resultsDiv.innerHTML = ""; // ×× ×§×” ××ª ×”×ª×•×¦××•×ª ×”×§×•×“××•×ª

        if (!Array.isArray(data)) {
            throw new Error("âŒ ×”× ×ª×•× ×™× ×©×”×ª×§×‘×œ×• ××™× × ××¢×¨×š! " + JSON.stringify(data));
        }

        if (data.length === 0) {
            resultsDiv.innerHTML = `<p>âŒ ×œ× × ××¦××• ×—×§×œ××™× ×‘×©× "${query}"</p>`;
            return;
        }

        data.forEach(farmer => {
            const farmerInfo = `<p>ğŸ‘¨â€ğŸŒ¾ <strong>${farmer.Name}</strong> - ${farmer.FarmName}, ğŸ“ ${farmer.Telephone}</p>`;
            resultsDiv.innerHTML += farmerInfo;
        });

    } catch (error) {
        console.error("âŒ ×©×’×™××” ×‘×—×™×¤×•×© ×—×§×œ××™×:", error);
        alert("âŒ ×©×’×™××” ×‘×—×™×¤×•×© ×—×§×œ××™×: " + error.message);
    }
}
        // ğŸ”¹ **×”×•×¡×¤×ª ×—×§×œ××™ ×—×“×©**
        document.getElementById("addFarmerForm").addEventListener("submit", async function(event) {
            event.preventDefault(); // ××•× ×¢ ×¨×¢× ×•×Ÿ ×“×£

            const farmerData = {
                Name: document.getElementById("Name").value,
                FarmName: document.getElementById("FarmName").value,
                Telephone: document.getElementById("Telephone").value,
                Email: document.getElementById("Email").value,
                Address: document.getElementById("Address").value,
                QuantityOfDunams: document.getElementById("QuantityOfDunams").value,
                WorkingDays: document.getElementById("WorkingDays").value,
                BriefExplanationOfWork: document.getElementById("BriefExplanationOfWork").value,
                IDNumber: document.getElementById("IDNumber").value,
                RelevantStartTime: document.getElementById("RelevantStartTime").value,
                RelevantEndTime: document.getElementById("RelevantEndTime").value,
                DesiredVolunteersCount: document.getElementById("DesiredVolunteersCount").value,
                ACTIV: document.getElementById("ACTIV").value
            };

            try {
                const response = await fetch("http://localhost:3333/farmerD/Add", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(farmerData)
                });

                const data = await response.json();
                alert(data.message);
                document.getElementById("addFarmerForm").reset();
                getFarmers(); // ×¨×¢× ×•×Ÿ ×¨×©×™××ª ×”×—×§×œ××™×
            } catch (error) {
                console.error("âŒ ×©×’×™××” ×‘×”×•×¡×¤×ª ×—×§×œ××™:", error);
                alert("âŒ ×©×’×™××” ×‘×”×•×¡×¤×ª ×—×§×œ××™");
            }
        });
        // ğŸ”¹ **××—×™×§×ª ×—×§×œ××™**
        async function deleteFarmer(id) {
    if (!id || isNaN(id)) {
        console.error("âŒ ×©×’×™××”: ID ×œ× ×ª×§×™×Ÿ!", id);
        alert("âŒ ×©×’×™××”: ID ×œ× ×ª×§×™×Ÿ!");
        return;
    }

    if (!confirm("ğŸ—‘ï¸ ×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×”×—×§×œ××™?")) return;

    console.log(`ğŸ“¡ ×©×œ×™×—×ª ×‘×§×©×ª ××—×™×§×” ×œ-ID: ${id}`);

    try {
        const response = await fetch(`http://localhost:3333/farmerD/Delete/${id}`, { method: "DELETE" });

        if (!response.ok) {
            throw new Error(`âŒ ×©×’×™××” ×‘××—×™×§×”: ${response.status}`);
        }

        const data = await response.json();
        console.log("âœ… ×ª×’×•×‘×ª ××—×™×§×” ××”×©×¨×ª:", data);

        alert(data.message);
        getFarmers(); // ×¨×¢× ×•×Ÿ ×¨×©×™××ª ×”×—×§×œ××™×

    } catch (error) {
        console.error("âŒ ×©×’×™××” ×‘××—×™×§×ª ×—×§×œ××™:", error);
        alert("âŒ ×©×’×™××” ×‘××—×™×§×ª ×—×§×œ××™: " + error.message);
    }
}
        // ğŸ”¹ **×”×¤×¢×œ×ª ××¦×‘ ×¢×¨×™×›×” ×¢×‘×•×¨ ×—×§×œ××™ ×¡×¤×¦×™×¤×™**
        function enableEdit(id) {
    document.getElementById(`name-${id}`).disabled = false;
    document.getElementById(`farmName-${id}`).disabled = false;
    document.getElementById(`telephone-${id}`).disabled = false;
    document.getElementById(`email-${id}`).disabled = false;
    document.getElementById(`address-${id}`).disabled = false;
    document.getElementById(`quantity-${id}`).disabled = false;
    document.getElementById(`workingDays-${id}`).disabled = false;
    document.getElementById(`briefExplanation-${id}`).disabled = false;
    document.getElementById(`idNumber-${id}`).disabled = false;
    document.getElementById(`startTime-${id}`).disabled = false;
    document.getElementById(`endTime-${id}`).disabled = false;
    document.getElementById(`volunteers-${id}`).disabled = false;
    document.getElementById(`activ-${id}`).disabled = false;

    document.getElementById(`edit-btn-${id}`).style.display = "none";
    document.getElementById(`save-btn-${id}`).style.display = "inline-block";
}
        // ğŸ”¹ **×©××™×¨×ª ×”×©×™× ×•×™×™× ×•×©×œ×™×—×” ×œ×©×¨×ª**
        async function saveEdit(id) {
    const updatedData = {
        Name: document.getElementById(`name-${id}`).value,
        FarmName: document.getElementById(`farmName-${id}`).value,
        Telephone: document.getElementById(`telephone-${id}`).value,
        Email: document.getElementById(`email-${id}`).value,
        Address: document.getElementById(`address-${id}`).value,
        QuantityOfDunams: document.getElementById(`quantity-${id}`).value,
        WorkingDays: document.getElementById(`workingDays-${id}`).value,
        BriefExplanationOfWork: document.getElementById(`briefExplanation-${id}`).value,
        IDNumber: document.getElementById(`idNumber-${id}`).value,
        RelevantStartTime: document.getElementById(`startTime-${id}`).value,
        RelevantEndTime: document.getElementById(`endTime-${id}`).value,
        DesiredVolunteersCount: document.getElementById(`volunteers-${id}`).value,
        ACTIV: document.getElementById(`activ-${id}`).value
    };

    try {
        console.log(`ğŸ“¡ ×©×œ×™×—×ª ×¢×“×›×•×Ÿ ×œ-ID: ${id}`, updatedData);

        const response = await fetch(`http://localhost:3333/farmerD/Update/${id}`, {
            method: "PATCH",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(updatedData)
        });

        if (!response.ok) {
            throw new Error(`âŒ ×©×’×™××” ×‘×¢×“×›×•×Ÿ: ${response.status}`);
        }

        alert("âœ… ×—×§×œ××™ ×¢×•×“×›×Ÿ ×‘×”×¦×œ×—×”!");

        getFarmers(); // ×¨×¢× ×•×Ÿ ×”× ×ª×•× ×™× ×‘×˜×‘×œ×”

    } catch (error) {
        console.error("âŒ ×©×’×™××” ×‘×¢×“×›×•×Ÿ ×—×§×œ××™:", error);
        alert("âŒ ×©×’×™××” ×‘×¢×“×›×•×Ÿ ×—×§×œ××™: " + error.message);
    }
}

    </script>
</body>
</html>
