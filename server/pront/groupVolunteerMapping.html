<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <title>× ×™×”×•×œ ××©×™××•×ª ×§×‘×•×¦×•×ª</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            direction: rtl;
            text-align: right;
            padding: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: lightgray;
        }
        input {
            width: 90%;
        }
        button {
            padding: 5px 10px;
        }
    </style>
</head>
<body>
    <h1>ğŸ“‹ × ×™×”×•×œ ××©×™××•×ª ×§×‘×•×¦×•×ª</h1>
    <table id="groupVolunteerTable">
        <thead>
            <tr>
                <th>×©× ×§×‘×•×¦×”</th>
                <th>×©× ×—×§×œ××™</th>
                <th>××™×§×•× ×—×§×œ××™</th>
                <th>×ª××¨×™×š ××©×™××”</th>
                <th>×¡×˜×˜×•×¡</th>
                <th>×”×¢×¨×•×ª</th>
                <th>×©×¢×ª ×”×ª×—×œ×”</th>
                <th>×©×¢×ª ×¡×™×•×</th>
                <th>×“×™×¨×•×’</th>
                <th>××–×•×¨</th>
                <th>ğŸ“ ×¢×¨×•×š</th>
                <th>ğŸ—‘ï¸ ××—×§</th>
            </tr>
        </thead>
        <tbody>
            <!-- × ×ª×•× ×™× ×™×™×˜×¢× ×• ×“×™× ××™×ª -->
        </tbody>
    </table>
    <button onclick="addNewTaskRow()">â• ×”×•×¡×£ ×©×•×¨×” ×—×“×©×”</button>
</body>
<script>
    // ğŸ“‹ **×˜×¢×™× ×ª ×›×œ ×”××©×™××•×ª**
    async function getTasks() {
        try {
            const response = await fetch("http://localhost:3333/groupVolunteerMapping/all");
            if (!response.ok) throw new Error("âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×”××©×™××•×ª");
            const data = await response.json();
            const tableBody = document.querySelector("#groupVolunteerTable tbody");
            tableBody.innerHTML = ""; // × ×™×§×•×™ ×”×˜×‘×œ×”

            data.forEach(task => {
                const row = `
                    <tr id="task-${task.ID}">
                        <td>${task.GroupName}</td>
                        <td>${task.FarmerName}</td>
                        <td>${task.FarmerLocation}</td>
                        <td><input type="date" value="${task.DateAssigned || ''}" id="dateAssigned-${task.ID}" /></td>
                        <td><input type="text" value="${task.Status || ''}" id="status-${task.ID}" /></td>
                        <td><input type="text" value="${task.Notes || ''}" id="notes-${task.ID}" /></td>
                        <td><input type="time" value="${task.StartTime || ''}" id="startTime-${task.ID}" /></td>
                        <td><input type="time" value="${task.EndTime || ''}" id="endTime-${task.ID}" /></td>
                        <td><input type="number" value="${task.Rating || ''}" id="rating-${task.ID}" /></td>
                        <td><input type="text" value="${task.Area || ''}" id="area-${task.ID}" /></td>
                        <td>
                            <button onclick="editTask(${task.ID})">ğŸ“ ×¢×¨×•×š</button>
                            <button onclick="saveTask(${task.ID})" id="save-btn-${task.ID}" style="display:none;">ğŸ’¾ ×©××•×¨</button>
                        </td>
                        <td><button onclick="deleteTask(${task.ID})">ğŸ—‘ï¸ ××—×§</button></td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        } catch (err) {
            console.error("âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×”××©×™××•×ª:", err);
            alert("âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×”××©×™××•×ª");
        }
    }

    // â• **×”×•×¡×¤×ª ×©×•×¨×” ×—×“×©×”**
    function addNewTaskRow() {
        const tableBody = document.querySelector("#groupVolunteerTable tbody");
        const newRow = `
            <tr>
                <td><input type="text" id="newGroupName" placeholder="×©× ×§×‘×•×¦×”" /></td>
                <td><input type="text" id="newFarmerName" placeholder="×©× ×—×§×œ××™" /></td>
                <td><input type="text" id="newFarmerLocation" placeholder="××™×§×•× ×—×§×œ××™" /></td>
                <td><input type="date" id="newDateAssigned" /></td>
                <td><input type="text" id="newStatus" placeholder="×¡×˜×˜×•×¡" /></td>
                <td><input type="text" id="newNotes" placeholder="×”×¢×¨×•×ª" /></td>
                <td><input type="time" id="newStartTime" /></td>
                <td><input type="time" id="newEndTime" /></td>
                <td><input type="number" id="newRating" placeholder="×“×™×¨×•×’" /></td>
                <td><input type="text" id="newArea" placeholder="××–×•×¨" /></td>
                <td colspan="2">
                    <button onclick="addTask()">â• ×”×•×¡×£</button>
                </td>
            </tr>
        `;
        tableBody.innerHTML += newRow;
    }

    // â• **×”×•×¡×¤×ª ××©×™××” ×—×“×©×”**
    async function addTask() {
        const newTask = {
            GroupID: document.getElementById("newGroupName").value,
            FarmerID: document.getElementById("newFarmerName").value,
            DateAssigned: document.getElementById("newDateAssigned").value,
            Status: document.getElementById("newStatus").value,
            Notes: document.getElementById("newNotes").value,
            StartTime: document.getElementById("newStartTime").value,
            EndTime: document.getElementById("newEndTime").value,
            Rating: document.getElementById("newRating").value,
            Area: document.getElementById("newArea").value
        };

        try {
            console.log("ğŸ“¡ ×©×œ×™×—×ª ×‘×§×©×” ×œ×”×•×¡×¤×ª ××©×™××” ×—×“×©×”:", newTask);
            const response = await fetch("http://localhost:3333/groupVolunteerMapping/add", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(newTask)
            });
            if (!response.ok) throw new Error("âŒ ×©×’×™××” ×‘×”×•×¡×¤×ª ×”××©×™××”");
            alert("âœ… ××©×™××” × ×•×¡×¤×” ×‘×”×¦×œ×—×”!");
            getTasks(); // ×¨×¢× ×•×Ÿ ×¨×©×™××ª ×”××©×™××•×ª
        } catch (err) {
            console.error("âŒ ×©×’×™××” ×‘×”×•×¡×¤×ª ×”××©×™××”:", err);
            alert("âŒ ×©×’×™××” ×‘×”×•×¡×¤×ª ×”××©×™××”");
        }
    }

    // ğŸ“ **×¢×“×›×•×Ÿ ××©×™××”**
    async function editTask(id) {
        const updatedTask = {
            DateAssigned: document.getElementById(`dateAssigned-${id}`).value,
            Status: document.getElementById(`status-${id}`).value,
            Notes: document.getElementById(`notes-${id}`).value,
            StartTime: document.getElementById(`startTime-${id}`).value,
            EndTime: document.getElementById(`endTime-${id}`).value,
            Rating: document.getElementById(`rating-${id}`).value,
            Area: document.getElementById(`area-${id}`).value
        };

        try {
            console.log(`ğŸ“¡ ×©×œ×™×—×ª ×‘×§×©×” ×œ×¢×“×›×•×Ÿ ××©×™××” ×¢× ID: ${id}`, updatedTask);
            const response = await fetch(`http://localhost:3333/groupVolunteerMapping/edit/${id}`, {
                method: "PATCH",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(updatedTask)
            });

            if (!response.ok) throw new Error("âŒ ×©×’×™××” ×‘×¢×“×›×•×Ÿ ×”××©×™××”");
            alert("âœ… ××©×™××” ×¢×•×“×›× ×” ×‘×”×¦×œ×—×”!");
            getTasks(); // ×¨×¢× ×•×Ÿ ×¨×©×™××ª ×”××©×™××•×ª
        } catch (err) {
            console.error("âŒ ×©×’×™××” ×‘×¢×“×›×•×Ÿ ×”××©×™××”:", err);
            alert("âŒ ×©×’×™××” ×‘×¢×“×›×•×Ÿ ×”××©×™××”");
        }
    }

    // ğŸ—‘ï¸ **××—×™×§×ª ××©×™××”**
    async function deleteTask(id) {
        try {
            const response = await fetch(`http://localhost:3333/groupVolunteerMapping/delete/${id}`, { method: "DELETE" });
            if (!response.ok) throw new Error("âŒ ×©×’×™××” ×‘××—×™×§×ª ×”××©×™××”");
            alert("âœ… ××©×™××” × ××—×§×” ×‘×”×¦×œ×—×”!");
            getTasks();
        } catch (err) {
            console.error("âŒ ×©×’×™××” ×‘××—×™×§×ª ×”××©×™××”:", err);
            alert("âŒ ×©×’×™××” ×‘××—×™×§×ª ×”××©×™××”");
        }
    }

    // ×§×¨×™××” ×¨××©×•× ×™×ª ×œ×˜×¢×™× ×ª ×›×œ ×”××©×™××•×ª
    getTasks();
</script>
</html>
